### Сопоставление домена SSL

При запросе шифрования SSL / TLS клиент должен добавить доменное имя (указание имени сервера, SNI) в пакет подтверждения, чтобы запросить сертификат сервера. Это связано с тем, что несколько доменных имен могут быть сопоставлены с одним и тем же сервером, и серверу необходимо вернуть соответствующий сертификат доменного имени SSL в соответствии с доменным именем, запрошенным клиентом. HttpCanary создаст сертификат «человек посередине» (MITM) для рукопожатия путем анализа SNI.

![](/assets/ssl_sni.png)

При нормальной работе это не проблема. Однако во многих случаях сервер сопоставляет только доменное имя. Чтобы повысить скорость ответа, клиент может инициировать запрос с помощью прямого IP-соединения и не добавляет SNI в пакет подтверждения. В настоящее время HttpCanary не может получить доменное имя для создания сертификата посредника. Вверх. Если сертификат посредника не может быть создан, пакет данных с шифрованием SSL / TLS не может быть проанализирован. Мы видим данные, как показано на следующем рисунке:

![](/assets/ssl_host_mapping1.png)

В качестве примера возьмем пакет данных выше. Порт сервера - 443, что указывает на то, что это, скорее всего, запрос HTTPS. Первый пакет данных - это пакет подтверждения приветствия клиента, отправленный клиентом на сервер, а второй пакет - это пакет подтверждения приветствия сервера, отправленный сервером клиенту. Информация в красном поле в пакете Server Hello на рисунке - это информация о сертификате SSL, а доменное имя (CN) сертификата - github.com, но в первом пакете рукопожатия Client Hello информация об SNI отсутствует, то есть информация github.com отсутствует. . Поэтому HttpCanary получает зашифрованные пакеты SSL / TLS.

В этом случае вам необходимо вручную заполнить информацию о SNI.

#### Метод 1: автоматическое сопоставление

В меню дополнительных параметров нажмите «Сопоставление домена», чтобы автоматически сопоставить имя домена, привязанное к сертификату, с текущим IP-адресом.

![](/assets/ssl_host_mapping2.png)

#### Метод 2: Сопоставление вручную

В дополнение к автоматическому картированию также может быть выполнено ручное отображение. В «Настройки -> Управление сертификатами SSL -> Сопоставление доменных имен» нажмите кнопку «+» в правом верхнем углу, чтобы добавить доменное имя и IP-адрес.

![](/assets/ssl_host_mapping3.png)

Кроме того, он также поддерживает управление отображением доменных имен, функции пакетного импорта и экспорта.

![](/assets/ssl_host_mapping4.png)

После настройки сопоставления доменного имени пакет данных HTTPS в виде открытого текста может быть получен для анализа!



